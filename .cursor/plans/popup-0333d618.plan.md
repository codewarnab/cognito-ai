<!-- 0333d618-d504-4a79-b44b-1715faa1e4c7 88dcf560-bc7f-4ba5-94e3-1de952b139c3 -->
# Popup CTA + Status for History Search

### Scope

- Add a CTA in `src/popup.tsx` to open `chrome.runtime.getURL("tabs/history.html")` in a new tab.
- Add a lightweight status indicator showing: model readiness and global pause state.
- Keep popup responsive (<200ms). Avoid heavy I/O; no model or DB work in popup.

### Files

- Update `src/popup.tsx` (UI + handlers).
- Update `src/style.css` (tiny styles for button + status pill, reuse existing patterns).

### UI

- Place a small section at the top of the popup header with:
  - Button: “Open History Search”.
  - Inline status pill: "Model ready" or "Model downloading"; and "Paused" when capture is paused.
- No spinners; static text/icons that update once after mount.

### Data & Performance

- Data sources (read-only, best-effort in ≤150ms):
  - `chrome.storage.local.get(["paused", "modelVersion", "modelReady"])`.
  - Optional ping: `chrome.runtime.sendMessage({type: "history-status"})` with a 150ms timeout; ignore if late.
- Heuristics:
  - `modelReady = Boolean(modelReady) || Boolean(modelVersion)`.
  - `paused = Boolean(paused)`.
- Render immediately with default placeholders, then set state when data returns. No re-renders after first settle.

### Interaction Flow

1. User clicks “Open History Search”.
2. Try: `window.open(chrome.runtime.getURL("tabs/history.html"), "_blank")`.
3. Fallback: `chrome.tabs.create({ url: chrome.runtime.getURL("tabs/history.html") })`.
4. On error, show inline error text for this session; do not retry automatically.

### Error States

- If `chrome.runtime` unavailable or URL open fails: show "Couldn’t open History Search. Try again." with a small retry link.
- If storage read fails or times out: display status as "Unknown"; do not block UI.

### Essential Snippets

- Open History page:
```tsx
const openHistory = async () => {
  const url = chrome.runtime.getURL("tabs/history.html");
  try {
    const win = window.open(url, "_blank");
    if (!win) throw new Error("popup-blocked");
  } catch (_) {
    try { await chrome.tabs.create({ url }); } catch {}
  }
};
```

- Read status (race with timeout):
```tsx
const withTimeout = (p: Promise<any>, ms = 150) => Promise.race([
  p, new Promise((res) => setTimeout(() => res(undefined), ms))
]);

useEffect(() => {
  (async () => {
    const st = await withTimeout(chrome.storage.local.get(["paused","modelVersion","modelReady"]));
    const paused = Boolean(st?.paused);
    const modelReady = Boolean(st?.modelReady) || Boolean(st?.modelVersion);
    setStatus({ paused, modelReady, error: false });
  })().catch(() => setStatus({ paused: false, modelReady: false, error: true }));
}, []);
```


### Styling

- Add minimal CSS classes: `.history-cta`, `.status-pill`, `.status-ok`, `.status-warn`, `.status-paused`.
- Reuse current color scheme; keep sizes small; no layout changes.

### Accessibility

- Button has `aria-label="Open History Search page"`.
- Status text is visible and has sufficient contrast.

### Acceptance Tests

- Render shows button within 50ms and is clickable.
- Clicking CTA opens a new tab with `tabs/history.html`.
- If `window.open` blocked, fallback creates tab via `chrome.tabs.create`.
- Status shows "Model ready" when `modelVersion` or `modelReady` present; shows "Model downloading" otherwise.
- Status shows "Paused" when `paused=true`.
- If storage read fails or times out, status shows "Unknown" and CTA still works.
- No heavy work in popup: no fetch, no model load, no DB queries; only `chrome.storage.local` and one message with 150ms timeout.

### To-dos

- [ ] Add CTA and status UI to src/popup.tsx
- [ ] Read paused/model-ready from storage with 150ms timeout
- [ ] Implement open history flow with fallback and errors
- [ ] Add minimal styles to src/style.css for status pill
- [ ] Validate UI renders fast, opens tab, shows statuses and errors